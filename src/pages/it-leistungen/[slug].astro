```astro
---
import { getCollection, getEntry, type CollectionEntry } from 'astro:content';
import { Image } from 'astro:assets';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Hero from '../../components/Hero.astro';
import Section from '../../components/Section.astro';
import CTA from '../../components/CTA.astro';
import Card from '../../components/Card.astro';
import Icon from 'astro-icon';

export async function getStaticPaths() {
  const allServices = await getCollection('services');
  return allServices.map(service => ({
    params: { slug: service.slug },
    props: { service },
  }));
}

type Props = {
  service: CollectionEntry<'services'>;
}

const { service } = Astro.props;
const { Content } = await service.render();

// Fetch related certifications if they exist
const relatedCertifications = service.data.related_certifications ? await Promise.all(
  service.data.related_certifications.map(slug => getEntry('certifications', slug))
) : [];
const validCertifications = relatedCertifications.filter(Boolean) as CollectionEntry<'certifications'>[];

// Fetch a featured testimonial as a fallback for social proof
const featuredTestimonial = (await getCollection('testimonials', ({ data }) => {
  return data.is_featured === true;
}))[0];
---

<BaseLayout
  title={service.data.seo_title || service.data.title}
  description={service.data.seo_description || service.data.summary}
  ogImage={service.data.hero_image?.src}
>
  <Hero
    variant="split"
    title={service.data.title}
    subtitle={service.data.summary}
    ctaText="Kostenlose Beratung anfordern"
    ctaHref="/kontakt"
  >
    <div slot="image">
      {service.data.hero_image && (
        <Image
          src={service.data.hero_image}
          alt={`Visual representation for ${service.data.title}`}
          class="rounded-2xl shadow-xl w-full h-auto object-cover max-h-[500px]"
          widths={[400, 800]}
          sizes="(max-width: 768px) 100vw, 40vw"
        />
      )}
    </div>
  </Hero>

  <Section variant="light" padding="sm">
    <div class="grid grid-cols-1 lg:grid-cols-3 lg:gap-16">
      <div class="lg:col-span-2 prose max-w-none">
        <Content />
      </div>
      <aside class="mt-12 lg:mt-0">
        {validCertifications.length > 0 && (
          <div class="bg-white p-8 rounded-2xl shadow-md border border-surface-200">
            <h3 class="text-2xl font-bold text-primary-700 mb-6">Geprüfte Expertise</h3>
            <div class="flex flex-col gap-6">
              {validCertifications.map(cert => (
                <a href={cert.data.partner_url} target="_blank" rel="noopener noreferrer" class="flex items-center gap-4 group">
                  <div class="bg-surface-100 p-3 rounded-lg">
                    <Image src={cert.data.logo} alt={`${cert.data.partner_name} Logo`} width={40} height={40} class="h-10 w-10 object-contain" />
                  </div>
                  <div>
                    <p class="font-semibold text-primary-700 group-hover:text-accent-600 transition-colors duration-200 ease-in-out">{cert.data.partner_name}</p>
                    <p class="text-sm text-surface-600">{cert.data.level}</p>
                  </div>
                </a>
              ))}
            </div>
          </div>
        )}
      </aside>
    </div>
  </Section>
  
  {featuredTestimonial && (
    <Section variant="default" padding="md">
      <div class="max-w-4xl mx-auto text-center">
        <div class="bg-surface-100 rounded-2xl shadow-lg p-8 md:p-12">
          <div class="flex justify-center mb-4">
            {[...Array(5)].map(() => (
              <Icon name="lucide:star" class="w-6 h-6 text-yellow-500 fill-current" />
            ))}
          </div>
          <blockquote class="text-2xl italic font-light leading-relaxed text-surface-800 mb-6">
            "{featuredTestimonial.data.quote}"
          </blockquote>
          <p class="text-lg font-medium text-primary-700">
            {featuredTestimonial.data.author_name}
            {featuredTestimonial.data.author_company && (
              <span class="text-surface-600 font-normal block mt-1">{featuredTestimonial.data.author_company}</span>
            )}
          </p>
        </div>
      </div>
    </Section>
  )}

  <CTA
    title={`Bereit für erstklassigen ${service.data.title}?`}
    text="Kontaktieren Sie uns noch heute für eine unverbindliche Erstberatung und erfahren Sie, wie wir Ihr Unternehmen unterstützen können."
    buttonText="Jetzt Kontakt aufnehmen"
    buttonHref="/kontakt"
  />

</BaseLayout>

<style is:global>
  .prose {
    color: var(--tw-prose-body);
    max-width: 65ch;
  }
  .prose h1, .prose h2, .prose h3, .prose h4 {
    color: var(--tw-prose-headings);
    font-weight: 700;
  }
  .prose h2 {
    font-size: 1.875rem; /* 30px */
    line-height: 1.4;
    margin-top: 2.5rem;
    margin-bottom: 1.25rem;
  }
  .prose h3 {
    font-size: 1.5rem; /* 24px */
    line-height: 1.5;
    margin-top: 2rem;
    margin-bottom: 1rem;
  }
  .prose p {
    margin-top: 1.25em;
    margin-bottom: 1.25em;
    font-size: 1.125rem;
    line-height: 1.75rem;
  }
  .prose a {
    color: theme('colors.accent.500');
    font-weight: 500;
    text-decoration: none;
    transition: color 0.2s ease-in-out;
  }
  .prose a:hover {
    color: theme('colors.accent.600');
    text-decoration: underline;
  }
  .prose strong {
    color: var(--tw-prose-bold);
    font-weight: 600;
  }
  .prose ul {
    margin-top: 1.25em;
    margin-bottom: 1.25em;
    padding-left: 1.625em;
    list-style-type: disc;
  }
  .prose ul > li {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
    padding-left: 0.375em;
    font-size: 1.125rem;
    line-height: 1.75rem;
  }
  .prose ul > li::marker {
    color: theme('colors.primary.500');
  }

  :root {
    --tw-prose-body: theme('colors.surface.600');
    --tw-prose-headings: theme('colors.primary.700');
    --tw-prose-bold: theme('colors.surface.800');
  }
</style>
```